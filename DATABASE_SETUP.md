# إعداد قاعدة البيانات Supabase لمنصة Novii

## خطوات الإعداد

### 1. تشغيل سكريبت SQL

1. افتح حساب Supabase على https://supabase.com
2. اذهب إلى مشروعك
3. من القائمة الجانبية، اختر "SQL Editor"
4. افتح ملف `supabase_schema.sql` من هذا المشروع
5. انسخ المحتوى بالكامل والصقه في SQL Editor
6. اضغط "Run" لتشغيل السكريبت

### 2. ماذا يفعل السكريبت؟

يقوم السكريبت بإنشاء:

#### الجداول:
- `profiles` - ملفات تعريف المستخدمين
- `posts` - منشورات المستخدمين
- `comments` - التعليقات على المنشورات
- `likes` - الإعجابات على المنشورات والتعليقات
- `follows` - متابعة المستخدمين
- `stories` - القصص (تنتهي بعد 24 ساعة)
- `story_views` - مشاهدات القصص
- `messages` - الرسائل الخاصة
- `notifications` - الإشعارات
- `saved_posts` - المنشورات المحفوظة

#### الميزات الأمنية (RLS):
- Row Level Security policies لحماية البيانات
- المستخدمون يمكنهم رؤية فقط البيانات المسموح لهم برؤيتها
- الحسابات الخاصة محمية

#### المُحفّزات (Triggers):
- تحديث تلقائي لعدادات الإعجابات
- تحديث تلقائي لعدادات المتابعين
- تحديث تلقائي لعدادات التعليقات
- إنشاء ملف تعريف تلقائياً عند التسجيل

#### الفهارس (Indexes):
- تحسين أداء الاستعلامات
- تسريع البحث والفلترة

### 3. التحقق من النجاح

بعد تشغيل السكريبت، يجب أن ترى الجداول في:
- Table Editor في Supabase Dashboard
- يجب أن يكون هناك 10 جداول

### 4. الخطوة التالية

بعد إنشاء قاعدة البيانات، يمكنك:
1. ✅ استخدام Supabase Auth للتسجيل وتسجيل الدخول
2. ✅ إنشاء منشورات جديدة
3. ✅ إضافة تعليقات وإعجابات
4. ✅ متابعة مستخدمين آخرين
5. ✅ إرسال رسائل
6. ✅ مشاهدة الإشعارات

## ملاحظات مهمة

### حماية البيانات
- جميع الجداول محمية بـ Row Level Security
- المستخدمون يمكنهم فقط تعديل بياناتهم الخاصة
- البيانات الخاصة غير مرئية للمستخدمين الآخرين

### انتهاء صلاحية القصص
- القصص تنتهي تلقائياً بعد 24 ساعة
- يمكن تشغيل `cleanup_expired_stories()` دورياً لحذف القصص المنتهية

### الأداء
- تم إضافة فهارس لتحسين الأداء
- الاستعلامات محسّنة لتكون سريعة

## استكشاف الأخطاء

إذا ظهرت أخطاء:
1. تأكد من تشغيل السكريبت كاملاً
2. تحقق من وجود UUID extension
3. تأكد من أذونات المستخدم في Supabase
4. راجع Logs في Supabase Dashboard

## البيانات التجريبية

حالياً الموقع يعمل ببيانات فارغة. لإضافة بيانات تجريبية:
1. سجل مستخدمين جدد
2. أنشئ منشورات
3. أضف تعليقات وإعجابات

سيتم لاحقاً إضافة بيانات تجريبية تلقائياً للاختبار.
